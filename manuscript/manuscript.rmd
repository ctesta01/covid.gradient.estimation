---
title: Understanding Complex Patterns in Social, Geographic, and Economic Inequities in COVID-19 Mortality at the County Level in the US Using Generalized Additive Models
author: 
  - name: "Christian Testa"
    institute: "1"
    email: "ctesta@hsph.harvard.edu"
    correspondence: true
institute: 
  - "1": "Department of Social and Behavioral Sciences, Harvard T.H. Chan School of Public Health"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  bookdown::pdf_document2:
    pandoc_args:
      - '--lua-filter=scholarly-metadata.lua'
      - '--lua-filter=author-info-blocks.lua'
    toc: false
    number_sections: false
abstract: |
  I present three types of applications of generalized additive models (GAMs) to
  COVID-19 mortality rates in the US for the purpose of advancing methods to
  document inequities with respect to which communities suffered disproportionate
  COVID-19 mortality rates at specific times during the first three years of the 
  pandemic. First, GAMs can be used to describe the changing
  relationship between COVID-19 mortality and county-level covariates
  (sociodemographic, economic, and political metrics) over time. Second, GAMs can
  be used to perform spatiotemporal smoothing that pools information over time and
  space to address statistical instability due to small
  population counts or stochasticity can be summarized by a smooth, dynamic latent
  surface describing the mortality risk associated with geographic locations over
  time. Third, estimation of COVID-19 mortality associations with county-level covariates
  conditional on smooth spatiotemporal variation allows for more rigorous consideration
  of how socio-environmental contexts and policies may have impacted COVID-19 mortality.
  Each of these approaches
  provides a valuable perspective to documenting inequities in
  COVID-19 mortality by addressing the question of which populations have suffered
  the worst burden of COVID-19 mortality taking into account the nonlinear
  spatial, temporal, and social patterning of disease.
  \newline 
  
  \noindent Abbreviations used: United States (US), Coronavirus Disease 2019 (COVID-19), Generalized
  Additive Model (GAM), Centers for Disease Control and Prevention (CDC), Index of Concentration at the Extremes (ICE)
bibliography: bibliography.bib
csl: apa.csl
link-citations: true
urlcolor: blue
linkcolor: black
header-includes: 
  - \usepackage{pdflscape}
  - \newcommand{\blandscape}{\begin{landscape}}
  - \newcommand{\elandscape}{\end{landscape}}
---

<!--
TODO: 

Throughout/Overarching: 
  - Do I need to update all the models to separately control for age? Probably.
  - Do I want to have a supplementary materials section?
  - Talk about ecosocial theory (?) (Who benefits from harm done to whom?)

Abstract:
  - Add link to GitHub repository

Intro: 
  - add geographic background, like where the first cases were reported, 
  how COVID exploded in NYC, then the surges in the Midwest and South
  - add a primer on the relevance of spatiotemporal modeling
  

Methods: 
  - add intro to ICEraceinc (methods)
  - describe negative binomial models
  
Results:
  - add figure for temporal two-way interaction effects
  - present rate ratios (results)
  - present model comparisons (results, F-tests, AIC)

Discussion:
  - talk about how COVID has not been a win for health equity (discussion)
  - talk about limitations to being causal
  - talk about future directions

Conclusion:
  - summarize
--> 

```{r setup, echo = FALSE}
suppressMessages(library(here))

knitr::opts_chunk$set(
  echo = FALSE,
  warning = FALSE,
  message = FALSE,
  out.width = '100%'
)
```

# Introduction

As we enter the third winter with the novel coronavirus disease 
COVID-19 in the United States, evidence documenting the intense disparities in
COVID-19 mortality rates comparing socially advantaged and disadvantaged
populations continues to mount. Eliminating inequities in health outcomes has
been stated as a major policy goal of the Biden administration
[@the_white_house_executive_2021; @the_white_house_advancing_2022], representing
a revitalized commitment to health equity and underlining the importance of adequate
data reporting systems that report timely estimates of prevalent health inequities. To this
end, I use generalized additive models (GAMs) as a flexible regression
framework to illustrate the evolving roles and relationships sociodemographic,
geographic, and economic conditions have with respect to trends in COVID-19
mortality. The code, data, and documentation necessary to reproduce the analyses
contained in this paper are online and free to access at <https://github.com/ctesta01/covid.gradient.estimation>.

### Background

Having passed over 1 million COVID-19 deaths in the United States earlier this
year [@donovan_us_2022], and facing uncertain prospects for the third COVID-19
winter looming even as new iterations on the COVID-19 vaccines become available,
it remains critical that inequities in COVID-19 outcomes are documented and
analyzed to reckon with the unjust and unfair burden of preventable illness.
Even though the first vaccines were granted emergency use authorization by the
U.S. Food and Drug Administration in 2020 [@mayo_clinic_history_2022], with the
first shots going in arms in December 2020, COVID-19 is still continuing to
cause hundreds of deaths a day in the US in the fall of 2022
[@noauthor_united_2022].  The new bivalent vaccines released at the end of
August 2022 contain mRNA sequences from both the original strain as well as
the recently emergent BA.4 and BA.5 lineages in an effort to make the nation's immunity more
up-to-date and robust against the myriad of phylogenetic directions the COVID-19
virus is evolving to explore [@office_of_the_commissioner_coronavirus_2022].
Despite the updated bivalent boosters representing a significant step forward in
prevention strategy, less than 4% of eligible Americans had taken the booster in
the first month after it became available [@bendix_less_2022; @lambert_most_2022]. 
As such, and with an enduring history of inequities in health care access 
in the US [@ortega_ending_2021; @blendon_inequities_2002; @bailey_how_2021;
@okonkwo_covid-19_2021; @rapp_statelevel_2022;
@chrisler_ageism_2016; @feldman_health_2021; @carpenter_health_2021;
@whitehead_outness_2016], it is clear that without further intervention not all
communities will be equally able to benefit from the updated vaccines and
inequities in COVID-19 illness and mortality may persist despite the
technological innovations in vaccine technology.

### The Role of Geography in COVID-19 

```{r figure-county-trends, fig.cap = "Estimates of monthly COVID-19 mortality rates per 100,000 person-years by county organized by Census Division.  For each division, the median trendline and quantile ranges are shown weighted by county population size.", out.width = "6in", fig.align = 'center', fig.env = "figure*"}
knitr::include_graphics(here("analysis/02_plot_county_trends/county_trends_by_division.png"))
```

Prior literature has demonstrated that the spread and impact of COVID-19 has
varied geography over time reflecting dynamics in the timing of introduction and
transmission events. Methods employed to highlight the geographic patterning in
COVID-19 outcomes have included quantile regression
[@sigler_socio-spatial_2021], Besag-York-Molli\'e mixed models
[@whittle_ecological_2020], spatial cluster analysis [@sugg_mapping_2021],
geographically weighted regression [@mollalo_gis-based_2020;
@park_covid-19_2021], and others.

Figure \@ref(fig:figure-county-trends) shows the monthly COVID-19 mortality
rates for the counties grouped within each of the nine U.S. Census Divisions
[@us_department_of_commerce_economics_and_statistics_administration_census_2000]. 
The figure summarizes each division's median mortality rates
weighted by county population size. Quantile ranges are included to illustrate
the range of mortality rates observed, again weighted by county population size.
Notably, the mortality associated
with the early surge of cases starting in NYC and spreading through New York,
New Jersey, and Massachusetts is visible in the Middle Atlantic and New England
division figures. The figure also illustrates how the first peak in the
mortality time-series for states in the Midwest (West North Central, East North
Central) occurred later, in late 2020 and going into early 2021.

In the US context, one of the key aspects to the geographic story of COVID-19's
spread and diffusion was the early surge of cases and epicenter in New York City
during March 2020 [@thompson_covid-19_2020] followed by subsequent waves of cases in the
South and Midwest [@shumaker_covid-19_2020; @scott_these_2020; @glenza_covid_2020]. As Park et al. 
stated summarized trends in the US from March 2020 to May 2021, "hot spots have shifted from densely populated cities and the states with a high percentage of socially vulnerable individuals to the states with relatively relaxed social distancing requirements, and then to the states with low vaccination rates" [-@park_covid-19_2021]. 

When considering the drivers of the COVID-19 pandemic, it's necessary to note that 
geography and social conditions are inextricably linked. In July 2021, the CDC
reported that "the COVID-19 cumulative death rate in non-metropolitan areas has
exceeded that of metropolitan areas since December 2020," noting that of the
approximately 1/5th of Americans who live in rural areas, many "are considered
highly vulnerable according to CDC’s Social Vulnerability Index (SVI), which
includes factors such as housing, transportation, socioeconomic status, race,
and ethnicity" [@cdc_location_2021]. Moreover, rural communities often have
lower health insurance rates, higher disability rates, older populations, and
limited access to health care. One of CDC's Morbidity and Mortality Weekly
Reports found that vaccination against COVID-19 was lower in rural communities
than in urban communities between December 2020 and April 2021
[@murthy_disparities_2021].


### The Social Determinants of COVID-19 Mortality

Even since the beginning of the COVID-19 outbreak in the US, data reflected
sharp inequities in mortality rates.  During January 22nd to May 5th 2020,
county COVID-19 mortality rates were 4.94 (95% CI 4.78, 5.09) times higher in
counties in the highest quintile of percent People of Color (61%-100%) compared
to counties in the lowest quintile of percent People of Color (0%-17.2%)
[@chen_revealing_2021].  This was not wholly unanticipated: as COVID-19 was
beginning to take off in the US, some were already calling attention to the fact
that COVID-19 threatened to exacerbate existing disparities
[@kim_covid-19_2020]. Kim, Marrast, and Conigliaro noted three structural
barriers in COVID-19 prevention and care: 1) originally requiring New York
residents to have a doctor's prescription for a COVID-19 test reduced the
opportunity for healthcare for People of Color as they are less likely to have a
primary care provider; 2) drive-through testing made testing disadvantaged those
who rely on public transportation; 3) quarantining at home while waiting the
7-10 days originally required for COVID-19 test results to come back posed an
economic and social challenge that many in already financially difficult
situations may not have been able to take on [-@kim_covid-19_2020]. Others noted
yet more reasons why COVID-19 threatened to worsen an already inequitable
healthcare landscape in the US: those who reside in prisons and jails,
immigrants and undocumented people, people with disabilities, and people
experiencing homeless all face additional challenges in seeking and getting the
healthcare they deserve [@okonkwo_covid-19_2021]. Despite stay-at-home orders
that were prevalent in many states [@moreland_timing_2020], workers functioning in 
capacities essential to the functioning of critical infrastructure operations (later
termed "essential workers") were exposed to heightened risk of COVID-19 transmission 
[@national_conference_of_state_legislatures_covid-19_2021; @wei_risk_2022; @national_bureau_of_economic_research_measuring_2021; @the_lancet_plight_2020; @hanage_covid-19_2020].
It's not just a hypothetical that those with more structurally enfranchised
privileges have been more able to mitigate their risk of negative health
outcomes associated with COVID-19 — during February 1 to April 1, 2020, New York
City residents who lived in more affluent neighborhoods were more likely to have
left the city, while New York City residents from more Black and Hispanic
neighborhoods were more likely to continue working [@coven_disparities_2020].

> Contrary to the oft used phrase that the ‘virus does not discriminate’, the
data presented here suggest that this virus, as many other infectious diseases,
has the greatest implications for the most vulnerable people. The intersections
between health and human rights are clear—the health of a society and
vulnerability to a pandemic are directly related to its human rights track
record for those who are marginalised. [@okonkwo_covid-19_2021]

When vaccines became available, vaccine appointments were often only available
to be scheduled through online web-portals contributing to the inequities
between those who had internet access and technological literacy and those who
didn't [@press_inequities_2021]. Vaccination sites have not been equally
distributed and areas determined to be vaccine deserts have been found to have
disproportionately more Black and Hispanic residents [@rader_spatial_2021]. In
fact, healthcare facilities in counties with higher Black composition had 32%
(95% CI 14%-47%) lower odds of serving as vaccine sites
[@hernandez_disparities_2022].

What vaccination has been administered hasn't suddenly erased the unequal burden
of COVID-19 either; in August 2022 the New York Times was reporting "Black death
rates at this winter’s peak were greater than those of white people by 34
percent in rural areas, 40 percent in small or medium cities and 57 percent in
big cities and their suburbs" [@goldstein_during_2022]. As COVID-19 case and
mortality rates have waxed and waned, the inequities have widen and shrunken,
often with racial/ethnic inequities growing during times when COVID-19 rates
have surged [@hill_covid-19_2022]. During 2022, the age-standardized
COVID-19 mortality rates for white people have, at times, been slightly 
higher than those of Black and Hispanic people, predominantly because the 
mortality rate among white people has increased [@johnson_whites_2022]. 
It's important to note that white COVID-19 mortality rates overtaking 
the Black mortality rates does not imply that equity has been established: neither
does this undo the cumulative impact of mortality (which has been twice as high for
Black people compared to white people [@hill_covid-19_2022]), nor does it imply 
the underlying systemic barriers to equity have been overturned
[@del_rios_covid-19_2022]. As Del Rios, Chomilo, and Lewis note, instead,
COVID-19 leaves in its wake more years of life expectancy lost, wages lost, and
degradation of mental health in Communities of Color.


# Methods

## Data Sources 

The following variables were retrieved at the county level: 

  * Counts of COVID-19 deaths [@the_new_york_times_coronavirus_2021].
  * Population size estimates for 2020 from the U.S. Census [@us_census_bureau_2020_2021].
  * Median age, median household income, racial/ethnic composition, population
  density, percent below the federal poverty line, and number of households with
  high (\$100k+)/low (<\$25k) household income by racial/ethnic group from the
  2014-2019 5-year American Community Survey [@us_census_bureau_american_2020]
  through the `tidyverse` R package [@walker_tidycensus_2022]. 
  * Votes cast in the 2020 presidential election [@mit_election_data_and_science_lab_county_2022]
  
## Generalized Additive Models

Generalized additive models (GAMs) improve upon generalized linear models by
allowing for the fitting of smooth functions that transform the $x$ variables.
This is a convenient means to include nonlinear relationships between the
outcome and predictor variables. Whereas a generalized linear model may look like 
$$ g(\mu_i) = \beta_0 + \beta_1 x_{i1} + \beta_2 x_{i2} + \beta_3 x_{i3} ...$$ 
a generalized additive model could look like 
$$ g(\mu_i) = \mathbf A_i \mathbf \theta + f_1(x_{i1}) + f_2(x_{i2}) + f_3(x_{i3}, x_{i4}) + \dots$$
where $\mu_i \equiv \mathbb E(Y_i)$, $\mathbf A_i$ is a row of the model matrix 
for any strictly non-parametric model components, $\mathbf \theta$ is the corresponding
parameter vector, and the $f_j$ are smooth functions of the covariates $x_k$ [@wood_generalized_2017]. 

```{r gam-demo-figure, fig.cap = "A demonstration of fitting regression models using B-spline basis functions. Part A. shows the simulated dataset. Part B. shows the B-spline basis functions. Part C. shows the weighting of the B-spline basis functions and their weighted sum with an intercept added to create the regression model fit to the data."}

knitr::include_graphics(here("analysis/10_supplementary_gam_figures/gam_demo_figure.png"))
```

The smooth functions estimated as part of fitting a GAM are constructed using
spline basis functions. These spline basis functions allow for the smooth
interpolation of trends in the data allowing for the incorporation of
nonlinearity. To avoid overfitting the data, a penalty term is introduced that
controls the degree of "wiggliness" or smoothness and this penalty term is fit
using generalized cross validation. B-splines are one kind of spline basis function 
that is commonly used and are especially popular because of their property that they 
are non-negative on only a finite interval. 

While a variety of varying kinds of spline bases exist (cubic splines, B- and
P-splines, thin-plate splines, etc.), our particular application setting
warrants the use of tensor-product smooths because we require anisotropic
penalization. That is to say, when we seek to create spatiotemporally smoothed
model estimates, it's inappropriate to assume that the amount of smoothing
across space should be the same as the amount of smoothing across time because
they're in fundamentally different units (space being measured in Cartesian
coordinates and time being measured in years, months, days, etc.). More details
about tensor-product smooths are available in Simon Wood's *Generalized Additive Models - An Introduction with R* [-@wood_generalized_2017]. 

## Overdispersion and Event Modeling

Above and beyond using the GAM framework to allow for flexible, nonlinear
relationships between our observed county-level variables and COVID-19
mortality, we must have a model specification that agrees with the data
generating process. In our case, the data generated are counts of deaths per
population, and the class of models most suited to represent counts of events
are Poisson, quasi-Poisson, and negative binomial models. Here we've chosen to 
use the negative binomial model as it accounts for overdispersion and has 
the intuitive interpretation of a Poisson model with gamma distributed underlying
rate parameter [@gelman_bayesian_2013]. 

A negative binomial model in the context of modeling count data can be written
$$y_i \sim \text{NegativeBinomial}(u_i \theta_i, \phi),$$
where $y_i$ are the counts observed, $u_i$ is the "exposure", $\theta_i$ are
the rates, and $\phi$ determines the amount of overdispersion. The rates
are modeled as $\theta_i = e^{X_i \beta}$ where $X_i$ are the observed
covariates and $\beta$ are the coefficients on the covariates corresponding
to log rate ratios. The logarithm of the exposure, $\log(u_i)$ is often called 
(and later herein referenced as) the offset. In epidemiological contexts, the offset 
is often representative of the amount of person-time during which observations were recorded. Whereas the Poisson model holds that $\text{var}(y) = \mu$ where $\mu$
is the average rate, the negative binomial model instead assumes that
$\text{var}(y) = \mu + \mu^2/\phi$. The Poisson model
is a special case of the negative binomial model when $\phi \to \infty$.

An alternative and equivalent formulation of the negative binomial that is commonly 
used makes the connection to the Poisson model even more clear: instead of 
$\theta_i$ and $\phi$, using $\alpha$ and $\beta$, 
$$y \sim \text{NegativeBinomial}(\alpha, \beta), \text{ and}$$
$$\text{NegativeBinomial}(y|\alpha, \beta) = \int \text{Poisson}(y|\theta) \text{Gamma}(\theta | \alpha, \beta) d\theta.$$

Introductions to and additional exposition on the negative binomial model,
especially in the context of modeling counts of events outcome data, are
available in *Bayesian Data Analysis* and *Regression and Other Stories*
[@gelman_regression_2020; @gelman_bayesian_2013].

## Variables of Interest

Besides age, which is a strong determinant of COVID-19 mortality risk, we have
included the following variables as covariates of interest:

  * Population Density per Square Mile
  * Median Household Income
  * Proportion in Poverty
  * the Index of Concentration at the Extremes for Racialized Economic Segregation 
  * Political Lean in the 2020 Election (1 = 100% Republican votes, -1 = 100% Democratic Votes)

#### Index of Concentration at the Extremes for Racialized Economic Segregation

The Index of Concentration at the Extremes (ICE) is a measure which describes
how concentrated a given area's population is in terms of the extreme ends of
privilege and marginalization [@krieger_public_2016]. 
In general, the ICE measure is formulated as

$$ \text{ICE} = \frac{\text{Number of People in Most Privileged Category} - \text{Number of People in Least Privileged Category}}{\text{Total Population}}$$

Applying the ICE approach to a specific context involves defining the axes of
privilege of interest.  In this case, data on racialized economic segregation
are used from the US Census American Community Survey on White households
earning more than $100,000 a year (the most privileged group) or households of
People of Color earning less than $25,000 a year (the least privileged group).
This variable is referred to throughout as the ICE for racialized economic
segregation, or `ICEraceinc` in the code.

Compared with the Gini
coefficient which is one of the most popular methods for summarizing area-level
rates of inequities, the ICE the major advantage that it is more suitable for
describing inequities at smaller area levels [@krieger_public_2016]. While the
Gini coefficient measures within-area dissimilarity (as in, for example, how
unequal wealth is distributed within a county), the ICE measure establishes
where on a spectrum a given county's population falls allowing for comparison
across counties. The Gini coefficient suffers from the fact that areas which are
made up of relatively homogeneous populations will appear as having low
within-area inequality (and therefore low Gini coefficient). Instead, the ICE
measures how much of the population is either privileged or not. The Gini
coefficient remains useful for reporting on the degree of inequity in larger
areal units (like countries, states, and regions), but at smaller areal units
(like counties, ZIP codes, census tracts) can be more difficult to interpret and
compare. Maps of ICE measure can elucidate what spatial social segregation and
polarization exist, and the ICE for racialized economic segregation has been
repeatedly and significantly associated with COVID-19 outcomes
[@hanage_covid-19_2020; @chen_revealing_2021; @krieger_relationship_2022;
@eichenbaum_health_2022; @brown_ecological_2021; @sonderlund_racialized_2022;
@saha_neighborhood-level_2020].

#### Political Lean

Political lean has been associated with COVID-19 mortality in numerous studies,
with plausible mechanisms explaining the association including differences in
non-pharmaceutical intervention uptake (mask usage, social distancing,
quarantining), differences in rates of vaccination, differences in political
leadership's messaging, resource allocation, and the adoption of policy
interventions [@krieger_relationship_2022; @kaashoek_evolving_2021; @leonhardt_red_2021; @gonzalez_conservatism_2021; @grossman_political_2020]. 


# Results

## Application 1: Non-Spatial Covariate Effects Over Time 

The GAM models shown in Figure \@ref(fig:one-variable-over-time) are fit with the following structure using 
the `gam` function from the `mgcv` package [@wood_mgcv_2022]: 

```{r gam-demo-code, echo = TRUE, eval=FALSE}
gam(
  formula = deaths ~ s(median_age) + te(covariate, date, d=c(1,1)), # regression formula
  offset = log(popsize/1e5/12), # our offset represents the person-time
  data = df,     # our data-set of county-level observations
  family = nb(link='log')  # indicates negative binomial family and a log-link function
)
```

The formula used puts a one-dimensional smoothing spline to represent a
nonlinear age-effect and a two-dimensional tensor-product smooth on the
interaction between the given covariate and the date. The `d=c(1,1)` argument
provides the instruction necessary to consider covariate and date as being on
separate scales and therefore to fit the tensor-product smooth with anisotropy —
that is, to allow for independent amounts of scaling in the dimensions of the
covariate and time. The offset used structures the regression to estimate rates
in units of person-time per 100,000 person-years. Since the death counts are
aggregated to the monthly level, the person-time in units of 100,000
person-years are calculated by taking each county's population size, dividing by
100,000, and dividing by 12 (for the 12 months in a year).

The above structure is used to estimate models for our different `covariate`
variables of interest: median income, percent in poverty, the ICE for racialized
economic segregation, political lean.  The model presenting median age treats
median age as the main covariate of interest including it as the `te(covariate,
date, d=c(1,1))`. Results of these models are summarized in Figure
\@ref(fig:one-variable-over-time) where the additional COVID-19 mortality
associated with each covariate is visualized.

(ref:medianage) [@us_census_bureau_nation_2022]

```{r one-variable-over-time, fig.cap = "Additional COVID-19 mortality associated with covariates over time. A) age and time, B) log (base 10) population density and time, C) median income and time, D) proportion in poverty and time, E) ICEraceinc and time, F) political lean and time. In panels B-F the effect of age is marginalized out using the median age in the US, 38.8 (ref:medianage).", fig.align = 'center', out.height = '75%'}
knitr::include_graphics(here("analysis/04_one_variable_over_time/panel_figure.png"))
```

Likelihood ratio tests confirmed that models with covariates interacted with
time had significantly lower residual deviance ($p \leq 2.2e^{-16}$ for all
models) compared to models only including a spline term on median age and the
given covariate not interacted with time. The model interacting median age 
and time was compared to a model with a spline for median age alone. Akaike Information
Criteria values were also lower for all models compared to models that did
not interact the covariates with time.

A more complex non-spatial application of GAMs to describe the distribution of 
COVID-19 mortality in the US over time is to consider the associations of 
mortality with three-way interactions of time and two covariates taken together. 
In the following example, the formula used is `deaths ~ te(date, ICEraceinc, median_age, d=c(1,1,1))`.  Again, the `d` argument specifying the marginal 
basis dimensions is used indicate that each of the `date`, `ICEraceinc`, and 
`median_age` measures are in different units and should not be smoothed assuming
that a one unit difference in one variable is comparable to a one unit difference
in another variable. This approach is represented in Figure \@ref(fig:two-variables-over-time).

```{r two-variables-over-time, fig.cap="The changing interacted effect of the ICE for racialized economic segregation and age over time. A) May 2020, B) November 2020, C) May 2021, D) October 2021, E) February 2022, F) August 2022. An animated version is available online at \\url{https://github.com/ctesta01/covid.gradient.estimation/blob/main/analysis/05_two_variables_at_a_time/animation_ICEraceinc_age/readme.md}"}
knitr::include_graphics(here("analysis/05_two_variables_at_a_time/animation_ICEraceinc_age/panel_figure.png"))
```

\newpage
## Application 2: Spatiotemporal Smoothing

By fitting GAMs with a tensor-product smoothing term on latitude, longitude, and
time we can estimate a spatiotemporally smoothed trend in COVID-19 mortality. To
do this, the GAM is constructed similarly as in Application 1 but with the
smoothing term specified as `te(latitude, longitude, time, d=c(2,1))` where
`d=c(2,1)` indicates that `latitude` and `longitude` share the same dimensions
(i.e., both are spatial and in units of degrees) while the `time` data are in
separate units. Note that results presented in Application 2 and 3 are based on
county-level data from the contiguous US excluding Alaska and Hawaii.

Using GAMs to present spatiotemporally smoothed estimates of COVID-19 mortality
allows for the synthesis of trends over time. Whereas the raw rates of COVID-19
mortality are noisy due to 72% of the land area in the US being classified as
rural and low population density [@health_resources__services_administration_defining_2022], the spatiotemporally smoothed GAM estimates
use population weighting via the offset specified to estimate a latent surface
that represents localized mortality rate averages in spatial coordinates and in
time.

Figure \@ref(fig:crude-vs-smoothed) shows the difference between crude mortality
rates and spatially smoothed mortality rates in January 2022 to illustrate the
level of noise present in raw rates and how spatially smoothing synthesizes
local geographic patterns into interpretable trends that can be meaningfully
interpreted as local area mortality risk levels pooling information across
nearby county rates.

Figure \@ref(fig:spatiotemporal-panel-figure) shows the results from a
spatiotemporally smoothed model in select months to highlight how spatiotemporal
smoothing can yield results that intuitively synthesize trends in space and
time.

```{r crude-vs-smoothed, fig.cap = "Comparison of crude vs. smoothed mortality rates. A) Crude mortality rates per 100,000 person-years in January 2022. B) Smoothed mortality rates from a GAM applied to mortality rates from January 2022."}
knitr::include_graphics(here("analysis/08_spatiotemporal_autocorrelation/side_by_side_crude_and_smoothed.png"))
```

```{r spatiotemporal-panel-figure, fig.cap = "Spatiotemporally smoothed COVID-19 mortality estimates from a GAM fit to data from March 2020-August 2022. Panels show months selected to highlight the changing spatial patterns of COVID-19 mortality risk over time. An animated version is available online at \\url{https://github.com/ctesta01/covid.gradient.estimation/blob/main/analysis/09_spatiotemporal_models/animation/readme.md}"}
knitr::include_graphics(here("analysis/09_spatiotemporal_models/temporal_panel_figure.png"))
```

\newpage
## Application 3: Estimating Covariate Effects Adjusted for Spatiotemporal Autocorrelation

The final application of GAMs presented here is to estimate the effects of
covariates after adjusting for a spatiotemporally smoothed term as shown in
Application 2. This has the interpretation of asking what are the changes to
COVID-19 mortality rates associated with each covariate after taking into
account local geographic patterns over time. In particular, this is relevant for
understanding what county-level measures are associated with elevated COVID-19
mortality even after adjusting for where COVID-19 rates were locally elevated
or depressed due to variation in the timing of local introduction, transmission,
and diffusion. 

```{r neighboring-graph-morans-i, fig.cap = "The spatial autocorrelation of COVID-19 rates in January 2022. Panel A shows the graph of which US counties are connected by neighboring relations. Panel B shows a scatterplot depicting each US counties' COVID-19 rate (x-axis) compared to the average of its neighbors' COVID-19 mortality rates (y-axis). A regression line shows the association between counties' COVID-19 rates and their neighboring counties' COVID-19 rates.  Dotted lines indicated the average for US county-level crude COVID-19 mortality rates (vertical) and for the average of each counties' neighboring counties' COVID-19 rates (horizontal)."}
knitr::include_graphics(here("analysis/08_spatiotemporal_autocorrelation/county_network_and_morans_plot.png"))
```

```{r temporal-acf, fig.cap = "The median (black) and quantiles (shaded bands) of temporal autocorrelation of counties' COVID-19 mortality rates over time starting from April 2020.", out.width = '50%', fig.align='center'}
knitr::include_graphics(here("analysis/08_spatiotemporal_autocorrelation/temporal_acf.png"))
```

To motivate the need for and application of spatiotemporal smoothing in
assessing the associated changes in COVID-19 mortality with county-level
covariates, Figure \@ref(fig:neighboring-graph-morans-i) presents the Moran's I
diagnostic plot for January 2022 which summarizes the amount of autocorrelation
between counties' COVID-19 mortality rates and a population-weighted average of
each counties' neighboring counties' COVID-19 mortality rates. The observed
autocorrelation indicates that there is an association between counties'
COVID-19 rates and their neighboring counties' COVID-19 rates, implying that
without taking this patterning into account, regression models that do not
explicitly model the effect of spatial autocorrelation may be biased due to
inappropriately assuming that county-level data are independent of one another. Second, 
while the Moran's I plot demonstrates the spatial-correlation present in the data
at a single time-point, the following Figure \@ref(fig:temporal-acf) shows the
tendency of county COVID-19 observations to be autocorrelated between subsequent
months and moreover there appears to be an oscillating trend at the 6-month and
12-month marks suggestive of effects due to the dynamics associated with
temporary infection induced immunity and seasonality. 

```{r with-and-without-spatiotemporal-adjustment, fig.cap = "Estimates of increases in COVID-19 mortality associated with county-level covariates without (first) and with (second) adjustment for spatiotemporal autocorrelation. Panels A and B show COVID-19 mortality increases associated with varying levels of median age over time; C and D show associations with log population density; E and F median income; G and H for proportion in poverty; I and J the ICE for racialized economic segregation; K and L political lean.", out.width = '85%', fig.align='center'}
knitr::include_graphics(here("analysis/09_spatiotemporal_models/panel_figure.png"))
```

Figure \@ref(fig:with-and-without-spatiotemporal-adjustment) shows the effects associated
with each covariate over time with and without adjustment for spatiotemporal trends. 
The models for population density and median income show particularly marked changes
with the spike at high population density and high median incomes disappearing 
after adjusting for a spatiotemporally smoothed term. This likely reflects the
early emergence and surge of COVID-19 in the greater New York City area as being
predominantly a feature of the combined effect of human geography and infectious
disease dynamics where the earliest introductions of COVID-19 were made to dense
social networks in the US. Other effects remain qualitatively changed very little,
suggesting that the trends in COVID-19 mortality associated with these county-level
measures remains durable when taking into account spatiotemporal autocorrelation.

\newpage
# Discussion

This paper presents three applications of GAMs to county-level COVID-19
mortality data from the US during March 2020 to August 2022. This paper
addresses an important need, which is to assess what measures of the
socioeconomic and geopolitical landscape are associated with increases in
COVID-19 mortality in a way that takes into account how infectious disease
dynamics are locally correlated in space and time. However, the approaches
outlined in this paper are not without several limitations which include (at
least) the following: the potential for cross-level confounding, lack of
individual level data, an inability to include all possible metrics, further
improvements to the methods used may be warranted, and we are unable to make
claims about the causal relationships between the variables investigated.

In analyses that use area-level aggregated data, the ecologic fallacy refers to
the possibility that associations between area-level measures and outcomes may
not reflect the associations that would be observed if analyzing individual
level data on the same measures and outcomes as a result of cross-level
confounding [@greenland_ecologic_2001]. It's important to note that
some of the variables are included to contextualize the places in which people
live, reside, and work and area-based social metrics should be included in
individual-level analyses so as to accurately capture the effects of both
individual-level risk factors and risk factors that stem from the contexts in
which people exist [@testa_public_2022].

One particular improvement that could be made in future work is to address age
adjustment by using direct or indirect age standardization [@anderson_age_1998] or 
to create age-group stratified models. In the applications presented here,
county-level median age is adjusted for in order to control for age effects.

Additional variables like vaccination rates, mobility data, further variables
that relate to risk factors for COVID-19, and other COVID-19 related outcomes
like case trends and hospitalizations may be worthwhile to investigate under a
similar framework. The emphasis on trends in COVID-19 mortality in the
applications in this paper was done to prioritize presenting data that are less
subject to the reporting inconsistencies in COVID-19 cases and
hospitalizations [@galaitsi_challenges_2021]. 

Further improvements to the methods employed here could include use of soap film
smoothing splines which are more appropriate in settings where non-convex
geographic boundaries are common (as in with peninsulas and bays)
[@wood_soap_2008]. Taking a critical eye to the assumptions employed reveals yet
another area of potential improvement, which is the nature of how the complexity of the 
smoothing splines employed are penalized in the GAM framework. It is conceivable that
geographic changes in COVID-19 mortality rates are not equally smooth across 
all regions of the US, potentially warranting rapid changes in some areas 
and smooth changes in other areas. The Bayesian wombling literature provides
the means to identify areas of rapid change in latent surface models and may pose
a fruitful direction of exploration for future efforts to understand trends
in COVID-19 mortality rates in the US [@gelfand_bayesian_2015]. 

# Conclusions

This work introduces generalized additive models (GAMs) applied to COVID-19
mortality data to document the disparities and inequities in which US counties
at what times suffered the worst mortality outcomes. The effort to document
inequities and explain the driving mechanisms behind them is crucial in building
up the evidence necessary to enact policy changes that can mitigate unjust and
preventable harm in the future. To this end, it is critical that efforts to
model infectious disease dynamics take into account how disease transmission and
outcomes are spatiotemporally patterned, violating any misplaced assumptions
that area-level disease rates can be treated as independent observations. By
presenting novel applications of GAMs to trends in COVID-19 mortality, this
paper illustrates new ways of understanding and visualizing the disproportionate
burden some communities have suffered incorporating complex patterns of
interaction across socioeconomic and geopolitical variables and spatiotemporal
trends.

\newpage
# References

